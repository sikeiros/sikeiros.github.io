---
layout: base
---
{% comment %} entries newest → oldest {% endcomment %}
{% assign entries = site.archive | sort: "date" | reverse %}

{% comment %} Latest year; build a 12-month window starting from AUG of that year {% endcomment %}
{% assign latest = entries | first %}
{% assign year   = latest.date | date: "%Y" %}

{% comment %} Month sequence: Aug→Dec (this year), then Jan→Jul (next year) {% endcomment %}
{% assign head = "08,09,10,11,12" | split: "," %}
{% assign tail = "01,02,03,04,05,06,07" | split: "," %}
{% assign months = head | concat: tail %}

{% comment %} Compute which YYYY-MM actually exist {% endcomment %}
{% assign present = "" | split: "" %}
{% for it in entries %}
  {% assign ym = it.date | date: "%Y-%m" %}
  {% unless present contains ym %}
    {% assign present = present | push: ym %}
  {% endunless %}
{% endfor %}

<main>
  <h1>Archive</h1>

  <nav class="months" aria-label="Months">
    {% assign first_done = false %}
    {% for i in (0..5) %}
      {% assign m_top = months | slice: i, 1 | first %}
      {% assign m_bot = months | slice: i | plus: 6 | slice: 0, 1 | first %}

      {% assign ym_top   = year | append: "-" | append: m_top %}
      {% assign label_t  = year | append: "/" | append: m_top %}
      {% if present contains ym_top %}
        <a href="#{{ ym_top }}"{% unless first_done %} aria-current="true"{% assign first_done = true %}{% endunless %}>{{ label_t }}</a>
      {% else %}
        <span aria-disabled="true">{{ label_t }}</span>
      {% endif %}

      {% assign ym_bot   = year | append: "-" | append: m_bot %}
      {% assign label_b  = year | append: "/" | append: m_bot %}
      {% if present contains ym_bot %}
        <a href="#{{ ym_bot }}">{{ label_b }}</a>
      {% else %}
        <span aria-disabled="true">{{ label_b }}</span>
      {% endif %}
    {% endfor %}
  </nav>

  {% comment %} STREAM grouped by month, but no visible month headings {% endcomment %}
  {% assign current = "" %}
  {% for item in entries %}
    {% assign month_id = item.date | date: "%Y-%m" %}

    {% if month_id != current %}
      {% if current != "" %}</div></div>{% endif %}
      <div id="{{ month_id }}" class="month">
        <div class="story">
      {% assign current = month_id %}
    {% endif %}

    {{ item.output }}   

  {% endfor %}
  {% if current != "" %}</div></div>{% endif %}

  <div class="footer">
    This is a live archive of works, thoughts, screenshots. Nothing final, the process.
    Code: MIT. Text &amp; images: CC BY-NC-ND 4.0.
  </div>
</main>
