---
layout: base
---
{% comment %} Build newest→oldest list of items {% endcomment %}
{% assign entries = site.archive | sort: "date" | reverse %}

{% comment %} Determine the year to show (latest item’s year) {% endcomment %}
{% assign latest = entries | first %}
{% assign year   = latest.date | date: "%Y" %}

{% comment %} Make a set of year-month labels that actually exist (e.g., 2025-09) {% endcomment %}
{% assign present = "" | split: "" %}
{% for item in entries %}
  {% assign ym = item.date | date: "%Y-%m" %}
  {% unless present contains ym %}
    {% assign present = present | push: ym %}
  {% endunless %}
{% endfor %}

{% comment %} Build a 12-month ribbon for that year (Dec→Jan so newest is first) {% endcomment %}
{% assign months = "12,11,10,09,08,07,06,05,04,03,02,01" | split: "," %}

<main>
  <h1>Archive</h1>

  {% comment %} Full-year ribbon for latest year (Dec→Jan), interleaved per column {% endcomment %}
{% assign entries = site.archive | sort: "date" | reverse %}
{% assign latest  = entries | first %}
{% assign year    = latest.date | date: "%Y" %}

{% assign months  = "12,11,10,09,08,07,06,05,04,03,02,01" | split: "," %}
{% assign present = "" | split: "" %}
{% for it in entries %}
  {% assign ym = it.date | date: "%Y-%m" %}
  {% unless present contains ym %}
    {% assign present = present | push: ym %}
  {% endunless %}
{% endfor %}

<nav class="months" aria-label="Months">
  {% assign first_done = false %}
  {% for i in (0..5) %}
    {% assign m_top = months | slice: i, 1 | first %}
    {% assign m_bot_index = i | plus: 6 %}
    {% assign m_bot = months | slice: m_bot_index, 1 | first %}

    {%- assign ym_top = year | append: "-" | append: m_top -%}
    {%- assign label_top = year | append: "/" | append: m_top -%}
    {% if present contains ym_top %}
      <a href="#{{ ym_top }}"{% unless first_done %} aria-current="true"{% assign first_done = true %}{% endunless %}>{{ label_top }}</a>
    {% else %}
      <span aria-disabled="true">{{ label_top }}</span>
    {% endif %}

    {%- assign ym_bot = year | append: "-" | append: m_bot -%}
    {%- assign label_bot = year | append: "/" | append: m_bot -%}
    {% if present contains ym_bot %}
      <a href="#{{ ym_bot }}"{% unless first_done %} aria-current="true"{% assign first_done = true %}{% endunless %}>{{ label_bot }}</a>
    {% else %}
      <span aria-disabled="true">{{ label_bot }}</span>
    {% endif %}
  {% endfor %}
</nav>


  {% comment %} Stream grouped by month, newest→oldest (matches your old HTML) {% endcomment %}
  {% assign current = "" %}
  {% for item in entries %}
    {% assign month_id    = item.date | date: "%Y-%m" %}
    {% assign month_label = item.date | date: "%Y/%m" %}

    {% if month_id != current %}
      {% if current != "" %}</div></div>{% endif %}
      <div id="{{ month_id }}" class="month">
        <h2>{{ month_label }}</h2>
        <div class="story">
      {% assign current = month_id %}
    {% endif %}

    {{ item.output }}

  {% endfor %}
  {% if current != "" %}</div></div>{% endif %}

  <div class="footer">
    This is a live archive of works, thoughts, screenshots. Nothing final, the process.
    Code: MIT. Text &amp; images: CC BY-NC-ND 4.0.
  </div>
</main>
